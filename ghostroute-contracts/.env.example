# GhostRoute Contracts Deployment

# ============================================
# Environment Variables
# ============================================

# Network Configuration
RPC_URL="http://127.0.0.1:8545"
CHAIN_ID=31337

# Deployer Private Key (use environment variable or .env file)
# PRIVATE_KEY="0x..."

# Etherscan/Blockscout API Key (for contract verification)
ETHERSCAN_API_KEY=""

# Deployment Options
VERIFY=false
FORCE=false
SALT=""

# ============================================
# Quick Start Commands
# ============================================

# Anvil (Local Development)
# 1. Start anvil: anvil
# 2. Run deploy:
#    export PRIVATE_KEY="0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"
#    forge script script/DeployAll.s.sol --rpc-url http://127.0.0.1:8545 --broadcast

# Sepolia Testnet
# 1. Get RPC URL from Alchemy or Infura
# 2. Export your private key (use a test account!)
# 3. Run deploy:
#    export RPC_URL="https://rpc.sepolia.org"
#    export PRIVATE_KEY="0x..."
#    forge script script/DeployAll.s.sol --rpc-url $RPC_URL --broadcast --verify

# Base Mainnet
# 1. Get RPC URL from Alchemy or Infura
# 2. Run deploy:
#    export RPC_URL="https://mainnet.base.org"
#    export PRIVATE_KEY="0x..."
#    forge script script/DeployAll.s.sol --rpc-url $RPC_URL --broadcast --verify

# ============================================
# Network Configurations
# ============================================

# Anvil (Local)
NETWORK_ANVIL_RPC="http://127.0.0.1:8545"
NETWORK_ANVIL_CHAIN_ID=31337

# Sepolia Testnet
NETWORK_SEPOLIA_RPC="https://rpc.sepolia.org"
NETWORK_SEPOLIA_CHAIN_ID=11155111
NETWORK_SEPOLIA_POOL_MANAGER="0x..."
NETWORK_SEPOLIA_WETH9="0x..."

# Base Mainnet
NETWORK_BASE_RPC="https://mainnet.base.org"
NETWORK_BASE_CHAIN_ID=8453
NETWORK_BASE_POOL_MANAGER="0x..."
NETWORK_BASE_WETH9="0x..."

# Base Sepolia
NETWORK_BASE_SEPOLIA_RPC="https://sepolia.base.org"
NETWORK_BASE_SEPOLIA_CHAIN_ID=84532
NETWORK_BASE_SEPOLIA_POOL_MANAGER="0x..."
NETWORK_BASE_SEPOLIA_WETH9="0x..."

# Ethereum Mainnet
NETWORK_ETH_RPC="https://eth.llamarpc.com"
NETWORK_ETH_CHAIN_ID=1
NETWORK_ETH_POOL_MANAGER="0x..."
NETWORK_ETH_WETH9="0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"

# ============================================
# Helper Functions
# ============================================

# Deploy to a specific network
deploy() {
    local network=$1
    local rpc=$2
    local chain_id=$3
    
    echo "Deploying to $network (Chain ID: $chain_id)"
    echo "RPC: $rpc"
    
    if [ -z "$PRIVATE_KEY" ]; then
        echo "ERROR: PRIVATE_KEY not set"
        return 1
    fi
    
    cd /home/marcos-lobo/projetos/hackathons/anonex/ghostroute-contracts
    
    local cmd="forge script script/DeployAll.s.sol --rpc-url $rpc --chain $chain_id --broadcast"
    
    if [ "$VERIFY" = true ]; then
        cmd="$cmd --verify -vvvv"
    fi
    
    eval $cmd
}

# Deploy to Anvil
deploy-anvil() {
    export RPC_URL=$NETWORK_ANVIL_RPC
    export CHAIN_ID=$NETWORK_ANVIL_CHAIN_ID
    deploy "Anvil" $NETWORK_ANVIL_RPC $NETWORK_ANVIL_CHAIN_ID
}

# Deploy to Sepolia
deploy-sepolia() {
    export RPC_URL=$NETWORK_SEPOLIA_RPC
    export CHAIN_ID=$NETWORK_SEPOLIA_CHAIN_ID
    deploy "Sepolia" $NETWORK_SEPOLIA_RPC $NETWORK_SEPOLIA_CHAIN_ID
}

# Deploy to Base
deploy-base() {
    export RPC_URL=$NETWORK_BASE_RPC
    export CHAIN_ID=$NETWORK_BASE_CHAIN_ID
    deploy "Base" $NETWORK_BASE_RPC $NETWORK_BASE_CHAIN_ID
}

# Deploy to Base Sepolia
deploy-base-sepolia() {
    export RPC_URL=$NETWORK_BASE_SEPOLIA_RPC
    export CHAIN_ID=$NETWORK_BASE_SEPOLIA_CHAIN_ID
    deploy "Base Sepolia" $NETWORK_BASE_SEPOLIA_RPC $NETWORK_BASE_SEPOLIA_CHAIN_ID
}

# Deploy to Ethereum Mainnet
deploy-eth() {
    export RPC_URL=$NETWORK_ETH_RPC
    export CHAIN_ID=$NETWORK_ETH_CHAIN_ID
    deploy "Ethereum" $NETWORK_ETH_RPC $NETWORK_ETH_CHAIN_ID
}

# Verify contract on Etherscan/Blockscout
verify() {
    local contract_address=$1
    local contract_name=$2
    
    if [ -z "$ETHERSCAN_API_KEY" ]; then
        echo "ERROR: ETHERSCAN_API_KEY not set"
        return 1
    fi
    
    forge verify-contract --chain-id $CHAIN_ID --etherscan-api-key $ETHERSCAN_API_KEY $contract_address $contract_name
}

# Check deployment status
status() {
    local chain_id=${1:-$CHAIN_ID}
    local deployment_file="deployments/$chain_id.json"
    
    if [ -f "$deployment_file" ]; then
        echo "Deployment found for Chain ID $chain_id:"
        cat $deployment_file
    else
        echo "No deployment found for Chain ID $chain_id"
    fi
}
